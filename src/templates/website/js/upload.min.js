var previewNode=document.querySelector("#template");previewNode.id="";var previewTemplate=previewNode.parentNode.innerHTML;previewNode.parentNode.removeChild(previewNode);var myDropzone=new Dropzone(document.body,{url:"/panel/objects/photos/upload/",thumbnailWidth:80,thumbnailHeight:80,parallelUploads:10,previewTemplate:previewTemplate,autoQueue:false,previewsContainer:"#previews",clickable:".fileinput-button"});myDropzone.on("addedfile",function(file){file.previewElement.querySelector(".start").onclick=function(){myDropzone.enqueueFile(file);};});myDropzone.on("totaluploadprogress",function(progress){document.querySelector("#total-progress .progress-bar").style.width=progress+"%";});myDropzone.on("sending",function(file,xhr,formData){formData.append("object_id",document.querySelector("#object_id").value);document.querySelector("#total-progress").style.opacity="1";file.previewElement.querySelector(".start").setAttribute("disabled","disabled");file.previewElement.querySelector(".start").value="Ładowanie pliku";});myDropzone.on("queuecomplete",function(progress){document.querySelector("#total-progress").style.opacity="0";$("body").loading('stop');setTimeout(function(){location.reload();},2000);});myDropzone.on("complete",function(file){file.previewElement.querySelector(".progress").style.opacity="0";file.previewElement.querySelector(".start").style.opacity="0";file.previewElement.querySelector(".delete").style.opacity="0";file.previewElement.querySelector(".error").innerHTML="Plik został załadowany";var elem=file.previewElement.querySelector(".error");console.log(elem);$(elem).parent().parent().fadeOut(2000);});document.querySelector("#actions .start").onclick=function(){$("body").loading({message:'Proszę czekać...<br/>Trwa ładowanie plików na serwer<br/>Po zakończeniu ładowania ta informacja zniknie<br/><br/><i class="fa fa-circle-o-notch fa-spin fa-2x"></i>'});myDropzone.enqueueFiles(myDropzone.getFilesWithStatus(Dropzone.ADDED));};document.querySelector("#actions .cancel").onclick=function(){myDropzone.removeAllFiles(true);$("body").loading('stop');};