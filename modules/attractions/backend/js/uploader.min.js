$(document).on("change",":file",function(){var a=$(this),b=a.get(0).files?a.get(0).files.length:1,c=a.val().replace(/\\/g,"/").replace(/.*\//,"");a.trigger("fileselect",[b,c])});
$(document).ready(function(){$(":file").off().on("fileselect",function(a,b,c){b=document.getElementById("attractions_id").value;b=parseInt(b);c=document.getElementById("token").value;console.log(c);var f=a.target.files;all_files=f.length;if(12<all_files||12<all_files)return $(this).removeClass("gallery-dragover"),a=$("#dropdown-upload-file").data("dragleave"),$("#dropdown-upload-file").empty().html(a).fadeIn(250),alertify.alert("Mo\u017cna wgra\u0107 maksymalnie 12 plik\u00f3w jednocze\u015bnie"),
!1;$("#upload-status").html("0 z "+all_files);a=$("#dropdown-upload-file").data("drop");$("#dropdown-upload-file").html(a);$("#ModalUploadProgress").modal("show");var g=0;for(a=0;a<all_files;a++){var e=new FormData;e.append("controller","\\Modules\\Attractions\\Backend\\Photos");e.append("method","photo_uploader");e.append("upload",f[a]);e.append("attractions_id",b);e.append("token",c);var d=new XMLHttpRequest;d.addEventListener("load",function(a){console.log(a.target.responseText);a=JSON.parse(a.target.responseText);
if(a.error)return $("#ModalUploadProgress").modal("hide"),alertify.alert("Wyst\u0105pi\u0142 b\u0142\u0105d podczas uploadu: "+a.msg),console.error(a),!1;if(a.success){g+=1;var b=Math.round(g/all_files*100);console.log(b);$("#progressbar").val(b);g>=f.length&&($("#ModalUploadProgress").modal("hide"),alertify.success("Upload zako\u0144czony pomy\u015blnie"),d.abort(),location.reload());console.log("should be uploaded "+a)}},!1);d.addEventListener("error",function(a){console.error("error");console.log(a);
alertify.error("Wyst\u0105pi\u0142 nieoczekiwany b\u0142\u0105d podczas uploadowanie plik\u00f3w")},!1);d.addEventListener("abort",function(a){console.warn("abort");console.log(a);alertify.error("Anulowano uploadowanie plik\u00f3w")},!1);d.open("POST","/upload/admin/",!0);d.setRequestHeader("Accept-Filetype","image/*");d.send(e)}})});
function enable_sortable(){$("#photos-list-items").sortable({update:function(a,b){b.item.data("priority",b.placeholder.index());var c=1;$(".ui-sortable-handle").each(function(a){a=$(this).data("id");var b=c;c+=1;a&&b&&$.ajax({async:!0,method:"POST",url:"/ajax/users/update_gallery_position",data:{id:a,priority:b},complete:function(a){}})});alertify.success("Zmieniono kolejno\u015b\u0107 zdj\u0119cia")}})}
function count_photos(){var a=0;$("#photos-list-items .box-gallery").each(function(){a++});return a};
